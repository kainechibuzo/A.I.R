<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AIR Monitor - Login/Register</title>
<style>
  body { font-family: Arial, sans-serif; display:flex; justify-content:center; align-items:center; height:100vh; background:#f4f4f4; }
  .container { background:#fff; padding:30px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1); width:300px; }
  input { width:100%; padding:10px; margin:5px 0; }
  button { width:100%; padding:10px; margin:10px 0; background:#4CAF50; color:white; border:none; cursor:pointer; }
  button:hover { background:#45a049; }
  .toggle { text-align:center; color:blue; cursor:pointer; font-size:0.9em; }
  .error { color:red; font-size:0.9em; margin-bottom:10px; }
</style>
</head>
<body>
<div class="container">
  <h2 id="formTitle">Login</h2>
  <div class="error" id="errorMsg"></div>
  <form id="authForm">
    <input type="text" id="username" placeholder="Username (register only)">
    <input type="email" id="email" placeholder="Email" required>
    <input type="password" id="password" placeholder="Password" required>
    <select id="plan">
      <option value="free">Free</option>
      <option value="pro">Pro</option>
    </select>
    <button type="submit" id="submitBtn">Login</button>
  </form>
  <div class="toggle" id="toggleForm">Don't have an account? Register</div>
</div>

<script>
const backendURL = "https://a-i-r-backend.onrender.com/api";

let isLogin = true;
const formTitle = document.getElementById("formTitle");
const toggleForm = document.getElementById("toggleForm");
const authForm = document.getElementById("authForm");
const submitBtn = document.getElementById("submitBtn");
const errorMsg = document.getElementById("errorMsg");

toggleForm.addEventListener("click", () => {
  isLogin = !isLogin;
  formTitle.textContent = isLogin ? "Login" : "Register";
  submitBtn.textContent = isLogin ? "Login" : "Register";
  toggleForm.textContent = isLogin ? "Don't have an account? Register" : "Already have an account? Login";
  document.getElementById("username").style.display = isLogin ? "none" : "block";
  document.getElementById("plan").style.display = isLogin ? "none" : "block";
  errorMsg.textContent = "";
});

authForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  errorMsg.textContent = "";
  const username = document.getElementById("username").value.trim();
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  const plan = document.getElementById("plan").value;

  try {
    const res = await fetch(`${backendURL}/${isLogin ? "login" : "register"}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(isLogin ? { email, password } : { username, email, password, plan })
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.message || "Error");
    
    if (isLogin) {
      localStorage.setItem("token", data.token);
      localStorage.setItem("username", data.username);
      localStorage.setItem("plan", data.plan);
      alert("Login successful!"); // Replace with redirect if needed
    } else {
      alert("Registration successful! Please login.");
      toggleForm.click();
    }
  } catch (err) {
    errorMsg.textContent = err.message;
  }
});

// hide username and plan initially for login
document.getElementById("username").style.display = "none";
document.getElementById("plan").style.display = "none";
</script>
</body>
</html>
